# 10.19

#### 一些概念

1. CAN线
2. 仪表盘
3. 整车控制器
   1. pin角
4. 软件组成
   1. 底层软件（包括I/O功能，诊断，通讯服务等，与硬件功能息息相关；底层软件是配置好的，不要求配置）
   2. 应用层软件（指VCU控制策略，长借助Simulink工具搭建策略模型，进行自动代码生成。
5. Simulink生成的代码为C代码，不能直接刷进控制器，将c代码编译成二进制语言才能被控制器识别。编译生成文件格式为：`.srv`  `.dll` `.a2l`
6. 问题：为什么底层软件不要求配置？买回来一个VCU控制器，底层软件是配置好的还是
7. simulink搭建的模型输出信号时有一个信号处理模块，通过处理后得出数据
8. ECU(Electronic Control Unit)
9. 常见的ECU有哪些？
   1. BMS(Battery Management System）电池管理系统
   2. VCU（Vehicle Control Unit）整车控制器
   3. BCM（Body Control Module）车身控制模块，主要控制车身电器，比如整车灯具、雨刮、洗涤、门锁、电动窗、天窗、电动后视镜、遥控等。
10. 纯电动汽车没有发动机，没有变速器，用电池包提供动力来源，用电机去转

#### 所需软件：

开发工具

- Matlab：Simulink/Stateflow
- MotoHawk(模型库)

编译器

- GreenHills
- gcc-powerpc-eabispe(代码生成配置的一个工具包)

刷写工具

- MotoTune

测试标定工具

- MotoTune

## 基本问题：

**问题1**：VCU是如何输入输出的？

输入：

- 硬线采集（直接和控制器引脚相连）
- CAN通讯（通过CAN与汽车其他控制器相连接交互）

输出：

- 硬线输出
- CAN通讯（通过CAN与汽车其他控制器相连接）

**问题2**：项目的流程是什么？

答案：

1. 搭建模型    
2. 生成代码
3. 软件刷写
4. 测试标定

总结：先进行模型搭建--->仿真测试--->测试完后点击`build model`生成代码--->在`MotoTune`进行刷写--->在`MotoTune`加载标定量观测量，通过修改标定量看观测量是否满足要求。

**问题3**：标定的作用是什么?

答案：程序被刷写到控制器之后，有些参数（特征参数）是可以修改的，借助测试标定工具`MotoTune`,读取vcu控制单元数据信息，改边特征参数值，验证控制效果，并选择控制效果最佳的参数值，以满足vcu功能需求。

**问题4**：刷写的步骤是什么？

1. 设置CAN波特率，保证Moto Tune的CAN通讯波特率与VCU定义的CAN通讯一致
2. 选择程序存放路径生成`srv`文件
3. 刷写，刷写成功后，系统提示`Programming Successful`

**问题5**：难点在哪个地方

为什么会产生这个问题：生成代码，软件刷写和测试标定可以理解是做什么的，但是搭建模型还是有点空泛

答案：软件模型是如何搭建的，这些模型有什么作用？

## 项目流程

**问题1**：如何刷写？

操作步骤：设置CAN波特率--->MotoTune软件左上角`file`--->`progran`--->打开编译`.srv`文件自动开始刷写--->刷写成功提示`programming successful`

**问题2**：如何标定？

操作步骤：

1. MotoTune软件左上角file下方**新建图标（new）**--->选择Calibration，确定--->
2. MotoTune软件左上角file下方**新建图标（new）**--->选择Display，确定--->

总结：观测量是不允许修改的，通过修改标定量观看对应的观测量是否符合预期。

## 第二节			

#### 目录

- 课程目标
  - 了解纯电动汽车基本结构和电控原理
  - VCU开发中CAN通信协议介绍
  - 了解AOTOSAR软件架构，熟悉VCU开发中常见功能分类
  - 掌握

- 纯电动车的结构和原理
- 整车CAN总线网络
- VCU软件架构
- VCU电控开发流程
- 功能安全标准解析

##### 纯电动车的结构和原理

1. 纯电动车基本结构

   1. 问题：什么是纯电动汽车？

      答案：以车载电源为动力，用电机驱动车轮行驶，符合道路安全，安全法规的车辆

   2. 问题：电源系统组成？.

      答案：电源系统由动力电池，电池管理系统（BMS），车载充电机（OBC)，直流转换器(DC/DC)等组成。但是，目前电源三合一（DC/DC转换器，充电机，高压控制盒（PDU)正成为当前发展趋势

   3. 问题：动力电池的作用是什么？低压蓄电池的作用又是什么？

      答案：

      - 动力电池是电动汽车的动力源，能量的存储装置
      - 低压蓄电池由DC/DC转换器输入的低压冲电，给动力转向，照明，空调等辅助用电装置供电

   4. 问题：车载充电机是什么?作用是什么？

      答案：

      - 车载充电机是固定安装在电动汽车上的充电机，具有为电动汽车动力电池，安全、自动充满电的能力，充电机依据电池管理系统（BMS）提供的数据，能动态调节充电电流或电压参数，执行相应的动作，完成充电过程。

      - 把电网供来的电转换为动力电池充电要求的制式

   5. 问题：DC/DC转换器是什么？作用是什么？

      答案：DC/DC转换器是转变输入电压并有效输出固定电压的电压转换器。

   6. 电驱系统的组成是什么？

      答案：

      - 由电机，电机控制器，机械传动装置组成。目前三合一电驱系统是潮流
      - 电机：车辆行驶的执行机构
      - 电机控制器：根据VCU指令，控制电机的旋转状态（正转/反转）
      - 减速器：一种传动装置

   7. 问题：除了电源系统，电驱系统，还有什么系统？

      答案：辅助系统

   8. 问题：三电是哪三电/三个控制单元？车上还有其他控制单元吗？

      答案：三电指VCU,MCU,BMS。还有其他控制单元，例如车身控制器，车载充电机等等

   9. 问题：VCU功能策略有哪些模块？

      - 上下电管理
      - 扭矩控制
      - 能量回收
      - 故障诊断
      - 巡航控制
      - 整车状态管理
      - 网络管理
      - ········

2. ##### 整车CAN总线网络

   1. CAN总线简介

      1. 问题：什么是CAN

         答案：

         - CAN(Controller Area Network)—控制器局部网络
         - CAN是德国Bosch公司为解决现代汽车中众多控制单元之间的实时数据交换而开发的一种`串行通讯协议`
         - CAN是一种现场总线

      2. CAN软件工具是用来做什么的？

         1. 工具：
            - CANoe
            - CANTEST
            - ···
            - 作用：设计，管理CAN网络通讯数据；监控记录，分析CAN网络报文信息

   2. CAN网络协议

   3. 整车CAN网络拓扑

##### 3.VCU软件架构

AUTOSAR:汽车开放系统架构，世界上有一个AUTOSAR联盟

