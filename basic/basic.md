# 电控开发基础

#### 新能源汽车核心技术

![image-20211109151004692](C:\Users\123\Program\VCU\basic\image\image-20211109151004692.png)

#### 可选择的岗位

![image-20211109151716906](C:\Users\123\Program\VCU\basic\image\image-20211109151716906.png)

#### D2P开发平台

![image-20211109152441531](C:\Users\123\Program\VCU\basic\image\image-20211109152441531.png)

#### 控制器针脚

![image-20211109152859948](C:\Users\123\Program\VCU\basic\image\image-20211109152859948.png)

#### 底层软件模块

![image-20211109153225520](C:\Users\123\Program\VCU\basic\image\image-20211109153225520.png)

编译工具模块 ：设置生成代码时使用的编译工具

触发模块：配置模型的调用周期

CAN模块：配置CAN的波特率

CCP协议模块：CCP协议的一个选择

#### 传感器

1. 什么是传感器？将其他各种信号转换为电信号输出的仪器。电信号又分为数字信号和模拟信号。

2. 传感器输出的信号有模拟信号和数字信号两种，数字信号可以直接进入电控单元，模拟信号需要通过AD转换器转换为数字信号再输入电控单元。

3. 加速踏板位置传感器，又称油门位置传感器，简称APP（Accelerator Pedal Position Sensor）

4. 传感器输出的开关信号只有0和1两个状态，**开关是最常见的数字信号，但是它并不会直接告诉控制器0或1，开关本质控制的是电压高低，经过控制器采集、处理之后，人为定义了0和1，所以认为开关是数字信号，采集和处理的过程依靠的就是硬件和底层软件**

   

5. **电信号，模拟信号，数字信号的关系？**

   电、声、光是按照信息的物理载体分类。信号是表示消息的物理量
   数字、模拟是根据信号与时间的关系分类的,所有**时间上离散的信号都可以视为数字信号**（广义）,狭义上的数字信号特指那些可以用二进制表示的离散信号.**模拟信号是时间上连续的信号**
   从这个分类可以看出,电信号可以有数字和模拟之分,光信号也可以有数字,模拟之分。

   <hr>

   **电信号是指随时间变化的电压或电流，由于非电的物理量可以通过各种传感器较容易地转换成电信号，而电信号又容易传送和控制，所以使其成为应用最广的信号。**

   电信号有哪些？

   根据信号的周期性还可以将信号分为周期信号和非周期信号

4. 踩下加速踏板与VCU的关系

![image-20211109155629860](C:\Users\123\Program\VCU\basic\image\image-20211109155629860.png)

加速踏板的开度通过加速踏板传感器（开度对应一个输出电压值）将电信号传给VCU（VCU内部有AD采样电路，采集传感器传来的电压值，再将电压值转换为数字信号（由底层软件判断电压高低）传给主芯片），VCU采集到信号以后，进入到底层软件的处理模块（在这里将采集到的数字信号通过底层模块再转换为电压值传递给应用层），应用层软件收到底层软件传来的电压值之后，通过一个表可以查到电压值对应的开度值。查到开度值之后，传给扭矩控制模块，扭矩控制模块根据踏板开度查表，确定开度对应输出的扭矩值。

问题：

1. 传感器传出的是电信号，底层软件将数字信号转换为电压值传给应用层，为什么传感器输出的电信号不能直接传给应用层？

   答：传感器不会直接发送0和1，它并不会直接告诉控制器0或1，例如开关本质控制的是电压高低，经过控制器采集、处理之后，人为定义了0和1，所以认为开关是数字信号

2. 为什么AD采样电路要改变传感器传过来的信号值？

   答：AD采样电路并没有改边信号值，传感器传来的不是0和1，本质控制的是电压高低，A/D采样电路采集电压，由软件判断高低

3. 能不能直接将加速踏板输出的电信号通过底层软件处理得到电压值？

   答：加速踏板传感器通过硬线与控制器相连，要经过电路对信号进行采集，再传送给底层软件

4. 底层软件处理的这个模块是什么模块，如何将传递过来的信号转换为电压值的？

   答：软件本身是不能处理电信号的，需要配合硬件一起使用（比如示例中所说的采样电路、主芯片）

**关键点：数字信号离不开对电信号的处理**

例如:空调开关，是数字信号0和1



思考：加速踏板位置传感器传递的信号代表的是开度。AD采样电路 底层软件处理后传递的信号代表的是电压值

加速踏板位置信号在应用层的处理

1. 加速踏板位置信号数据转换——根据电压信号查表得到一个开度值，再进行限幅，滤波处理，得到处理后的开度值
2. 加速踏板位置信号故障诊断
   1. 加速踏板位置信号有效性判断
   2. 加速踏板开度信息一致性判断
3. 加速踏板开度协调输出计算——根据加速踏板故障状态 输出加速踏板开度值

A/D转换器：是指一个将模拟信号转变为数字信号的电子元件。

#### 输入信号的处理

##### 硬线信号的处理



##### CAN线的处理

#### 一些概念

1. CAN线

2. 仪表盘

3. 整车控制器
   1. pin角
   
4. VCU组成

   VCU是由外壳，硬件电路，底层软件和应用层软件组成

   软件组成

   1. 底层软件（包括I/O功能，诊断，通讯服务等，与硬件功能息息相关；底层软件是配置好的，不要求配置）
   2. 应用层软件（指VCU控制策略，长借助Simulink工具搭建策略模型，进行自动代码生成。

6. Simulink生成的代码为C代码，不能直接刷进控制器，将c代码编译成二进制语言才能被控制器识别。编译生成文件格式为：`.srv`  `.dll` `.a2l`

7. 问题：为什么底层软件不要求配置？买回来一个VCU控制器，底层软件是配置好的还是

8. simulink搭建的模型输出信号时有一个信号处理模块，通过处理后得出数据

9. ECU(Electronic Control Unit)

9. 常见的ECU有哪些？

   10. BMS(Battery Management System）电池管理系统

   11. VCU（Vehicle Control Unit）整车控制器

   3. BCM（Body Control Module）车身控制模块，主要控制车身电器，比如整车灯具、雨刮、洗涤、门锁、电动窗、天窗、电动后视镜、遥控等。

13. 纯电动汽车没有发动机，没有变速器，用电池包提供动力来源，用电机去转

14. 芯片识别的是二进制语言，所以要将电信号转化为数字信号

#### 所需软件：

开发工具

- Matlab：Simulink/Stateflow
- MotoHawk(模型库)

编译器

- GreenHills
- gcc-powerpc-eabispe(代码生成配置的一个工具包)

刷写工具

- MotoTune

测试标定工具

- MotoTune

## 基本问题：

**问题1**：VCU是如何输入输出的？

输入：

- 硬线采集（直接和控制器引脚相连）
- CAN通讯（通过CAN与汽车其他控制器相连接交互）

输出：

- 硬线输出
- CAN通讯（通过CAN与汽车其他控制器相连接）

**问题2**：项目的流程是什么？

答案：

1. 搭建模型    
2. 生成代码
3. 软件刷写
4. 测试标定

总结：先进行模型搭建--->仿真测试--->测试完后进行编译，点击`build model`生成代码--->在`MotoTune`进行刷写--->在`MotoTune`加载标定量观测量，通过修改标定量看观测量是否满足要求。

**问题3**：标定的作用是什么?

答案：程序被刷写到控制器之后，有些参数（特征参数）是可以修改的，借助测试标定工具`MotoTune`,读取vcu控制单元数据信息，改边特征参数值，验证控制效果，并选择控制效果最佳的参数值，以满足vcu功能需求。

**问题4**：刷写的步骤是什么？

1. 设置CAN波特率，保证Moto Tune的CAN通讯波特率与VCU定义的CAN通讯一致
2. 选择程序存放路径生成`srv`文件
3. 刷写，刷写成功后，系统提示`Programming Successful`

**问题5**：难点在哪个地方

为什么会产生这个问题：生成代码，软件刷写和测试标定可以理解是做什么的，但是搭建模型还是有点空泛

答案：软件模型是如何搭建的，这些模型有什么作用？

## 项目流程

**问题1**：如何刷写？

操作步骤：设置CAN波特率--->MotoTune软件左上角`file`--->`progran`--->打开编译`.srv`文件自动开始刷写--->刷写成功提示`programming successful`

**问题2**：如何标定？

操作步骤：

1. MotoTune软件左上角file下方**新建图标（new）**--->选择Calibration，确定--->
2. MotoTune软件左上角file下方**新建图标（new）**--->选择Display，确定--->

总结?：观测量是不允许修改的，通过修改标定量观看对应的观测量是否符合预期。

<hr>



1. **问题：什么是纯电动汽车？**

   答案：以车载电源为动力，用电机驱动车轮行驶，符合道路安全，安全法规的车辆

2. **问题：电源系统组成？.**

   答案：电源系统由动力电池，电池管理系统（BMS），车载充电机（OBC)，直流转换器(DC/DC)等组成。但是，目前电源三合一（DC/DC转换器，充电机，高压控制盒（PDU)正成为当前发展趋势

3. **问题：动力电池的作用是什么？低压蓄电池的作用又是什么？**

   答案：

   - 动力电池是电动汽车的动力源，能量的存储装置
   - 低压蓄电池由DC/DC转换器输入的低压冲电，给动力转向，照明，空调等辅助用电装置供电

4. **问题：车载充电机是什么?作用是什么？**

   答案：

   - 车载充电机是固定安装在电动汽车上的充电机，具有为电动汽车动力电池，安全、自动充满电的能力，充电机依据电池管理系统（BMS）提供的数据，能动态调节充电电流或电压参数，执行相应的动作，完成充电过程。

   - 把电网供来的电转换为动力电池充电要求的制式

5. **问题：DC/DC转换器是什么？作用是什么？**

   答案：DC/DC转换器是转变输入电压并有效输出固定电压的电压转换器。

6. **电驱系统的组成是什么？**

   答案：

   - 由电机，电机控制器，机械传动装置组成。目前三合一电驱系统是潮流
   - 电机：车辆行驶的执行机构
   - 电机控制器：根据VCU指令，控制电机的旋转状态（正转/反转）
   - 减速器：一种传动装置

7. **问题：除了电源系统，电驱系统，还有什么系统？**

   答案：辅助系统

8. **问题：三电是哪三电/三个控制单元？车上还有其他控制单元吗？**

   答案：三电指VCU,MCU,BMS。还有其他控制单元，例如车身控制器，车载充电机等等

9. **问题：VCU功能策略有哪些模块？**

   - 上下电管理
   - 扭矩控制
   - 能量回收
   - 故障诊断
   - 巡航控制
   - 整车状态管理
   - 网络管理
   - ········

**问题：什么是CAN**

答案：

- CAN(Controller Area Network)—控制器局部网络
- CAN是德国Bosch公司为解决现代汽车中众多控制单元之间的实时数据交换而开发的一种`串行通讯协议`
- CAN是一种现场总线

**CAN软件工具是用来做什么的？**

1. 工具：
   - CANoe
   - CANTEST
   - ···
   - 作用：设计，管理CAN网络通讯数据；监控记录，分析CAN网络报文信息

2. CAN网络协议

3. 整车CAN网络拓扑

AUTOSAR:汽车开放系统架构，世界上有一个AUTOSAR联盟

vcu的开发涉及到的岗位：底层工程师，测试工程师，硬件工程师
