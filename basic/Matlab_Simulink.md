# Matlab/Simulink

##### 基础知识

- Simulink文件的扩展名：`.slx`或`.mdl`。两者区别在于slx是二进制文件，mdl是文本格式文件。slx旨在取代mdl文件。
- matlab代码文件的扩展名为`.m`
- Matlab/Simulink低版本无法打开高版本文件，保存成低版本对应的文件版本方可打开
- simulink是用步长进行计算的，把`步长/基础采样时间/采样时间`设置成1ms，1s对模型来说就是1000步
- Stateflow和Simulink都可以搭建实现某功能的模型，看哪个使用更方便就使用
- 步长不能过长，会影响精度，也不能过短
- simulin快捷键![image-20211022170853337](C:\Users\123\Program\VCU\basic\image-20211022170853337.png)



## Simulink建模基础

#### Simulink模块

##### 模块库：

1. Simulink模块库包含公共模块库和专业模块库
2. 公共模块库包含常用模块库等16个子库
3. 控制策略开发主要基于公共模块库中的模块

##### 模块：

- 模块是构成Simulink模型的元素，将各种模块信号相连，可完成相应的逻辑连接，实现相应的功能
- Simulink的强大之处在于它提供了丰富的标准模块库

##### Simulink基础模块—掌握其使用方法

1. 四则运算模块
2. 关系操作模块
3. 逻辑运算模块
4. 延时模块
5. 选择开关模块
6. 查表模块

模型的仿真

## Stateflow建模基础

##### 创建Stateflow模型

方法1：在Simulink库中找到Stateflow模块库的chart模块，将其添加到Simulink开发环境中

方法2：在Matlab命令行窗口输入命令`sf`，即可打开Stateflow工具箱`sflib`,并创建新的包含chart模块的Stateflow模型文件

##### Stateflow框图形式分类

- 在Stateflow模型中，将包含由状态的Stateflow框图成为状态图
- 在Stateflow模型中，讲不包含任何状态的Stateflow框图称为流程图

### 连接节点(Junction)

NOTE:

- 连接节点不是记忆元件，在状态图中任何转移的执行都不能停留在节点上，转移必须到达某个状态才能停止

- 依靠连接节点完成通路的连接和判断分支

### 转移

**创建转移的具体步骤**

1. 当鼠标光标接近状态的边缘时，鼠标光标将变成`十字形状`
2. 按下鼠标左键并保持，将引出的转移线放到目标状态的边缘即可

**概述**

- 当转移发生时，原状态变为非活动状态，目标状态变为活动状态
- 从图形上看，转移是带有箭头的线，是整个状态图或流程图变成了有向图

##### 默认转移

默认转移是一类特殊的状态转移。根据要求，当有限状态系统被激活时，必有相应的确定的某个状态被激活

##### 转移标签

- 一个完整的转移标签由四部分组成`event[conditon]{conditon actions}/{transtion actions}`
- `？`是默认的转移标签
- 转移标签的四个部分不一定完整出现，但不论出现哪些内容，标签内容必须按顺序写

**转移标签组成**

1. 事件：事件触发器指在已指定条件且条件为 true 时导致转移发生的事件。未指定事件表示在**发生任意事件时**都会产生该转移（什么时候会发生事件，在条件满足时）
2. 条件：条件表达式可以用`布尔操作符`和`逻辑操作符`进行判断
3. 条件动作：在转移标签语法中，条件动作接在转移条件后，只要条件计算结果为 true，条件动作即开始执行，无论转移至目标的路径是否有效。如果未指定任何条件，则隐含的条件会计算为 true，并执行条件动作。例如`满足条件X>1,执行赋值运算`
4. 转移动作：只有在整个转移路都有效时才能执行

##### Stateflow规定的转移优先级

1. 父状态转移优先于子状态转移
2. 同一层级安装**执行序号**转移（一个状态发生两个转移时，会有转移序号）

**问题**

条件动作和转移动作的区别：条件动作在条件满足时就能执行。而转移动作需要在整个转移通路都有效的情况下，在执行转移的时候才能执行



##### note：

1. 流程图不能包含任何状态，只能依靠连接节点完成通路的连接和判断分支

### 状态图（state)：

##### 状态名

添加的状态通过左上角`?`来表示目前状态还没有具体定义。

状态名命名要以字符开始

##### 状态标签

组成

1. 状态名称
2. 注释（可省略）`%注释内容`
3. 响应的状态动作

##### 状态动作

状态动作的关键字有三种：

1. entry/en:在状态被激活的**那一时刻**所执行的动作
2. exit/ex：当状态退出活动状态是执行相应的动作
3. during/du：当状态保持活动状态时执行相应的动作

### 流程图

简介：

- 流程图是不包含状态的Stateflow框图。流程图当中没有状态，主要用到的图形对象是连接节点和转移，用到的非图形对象就是数据对象
- 流程图总是从默认转移开始执行
- 流程图在无有效转移分支的节点上中止
- 流程图中默认转移的节点为判断节点，将**优先检测具有条件的分支**，如果条件满足则执行动作action,否则执行无条件转移，那里没有任何动作。最后所有转移都汇合到中止节点
- 连续的两次触发之间，流程图一直处于非活动状态
- 

流程图的创建：

1. 顺序结构 ：程序语句按照由上至下的次序依次执行
2. 选择结构：根据不同的条件进行判断，然后根据判断的结构选择某一种方法来解决某个问题
3. 循环结构：
   1. 程序中的某一条语句或者多条语句可以重复多次的执行
   2. `while循环`与`do while`循环

### 状态图与流程图的关系

- 状态框图有且只有一个状态图是要活着的
- 流程图只有节点和转移条件，没有记忆能力

## 问题

1. 如何建立一个simlink模型

2. 如何为自己搭建的模型设置输入输出

   通过`Model Explorer`



## 实践

### 空调控制模型

**空调控制的基本逻辑**

- 空调未打开时，车辆内部温度与外部温度逐渐趋于一致，但因收到车身隔热的情况，车辆内部温度上升的速度与车辆内外温差，绝缘系数有关
- 空调打开时，设定好目标温度，车辆内部温度按照一定的速率下降至目标温度点附近

