## Matlab/Simulink

##### 基础知识

- Simulink文件的扩展名：`.slx`或`.mdl`。两者区别在于slx是二进制文件，mdl是文本格式文件。slx旨在取代mdl文件。
- matlab代码文件的扩展名为`.m`
- Matlab/Simulink低版本无法打开高版本文件，保存成低版本对应的文件版本方可打开
- simulink是用步长进行计算的，把`步长/基础采样时间/采样时间`设置成1ms，1s对模型来说就是1000步
- Stateflow和Simulink都可以搭建实现某功能的模型，看哪个使用更方便就使用
- 步长不能过长，会影响精度，也不能过短
- 创建了一个subsystem，里面里面设置了输入信号，输出信号，子系统上会出现对应的接口
- simulin快捷键![](C:\Users\123\Program\VCU\basic\image\image-20211022170853337.png)

- matlab不能同时打开名字相同的两个模型，无论模型是否在同一路径下。

## Simulink建模基础

simulink模型简介：[Simulink 模型 - MATLAB & Simulink - MathWorks 中国]https://sourl.cn/y4nwPN)

**什么是Simulink**

Simulink是开发来用于动态系统和嵌入式系统的多领域模拟和基于模型的设计工具

#### Simulink模块

##### 模块库：

1. Simulink模块库包含公共模块库和专业模块库
2. 公共模块库包含常用模块库等16个子库
3. 控制策略开发主要基于公共模块库中的模块

##### 模块：

- 模块是构成Simulink模型的元素，将各种模块信号相连，可完成相应的逻辑连接，实现相应的功能
- Simulink的强大之处在于它提供了丰富的标准模块库

**重要模块**

Signal Builder

思考：创建一个子系统搭建模型，子系统内部设置了输入信号和输出信号，对应的，子系统外部会出现对应的接口。

输入信号连接谁，最终的输入信号是什么，怎么传进来。mil测试时创建可以用一个模块创建信号，真实情况下，信号来自于底层软件，输入信号如何在应应用层使用呢？

Scope:

**Simulink模型与Simulink模块的关系**

模块是构成Simulink模型的元素，通过拖拽模块库中的模块搭建模型

##### Simulink基础模块—掌握其使用方法

1. 四则运算模块
2. 关系操作模块
3. 逻辑运算模块
4. 延时模块
5. 选择开关模块
6. 查表模块

模型的仿真

## Stateflow建模基础

**什么是Srateflow?**

Stateflow提供了一种图形语言，包括状态转移图，流程图等，可以使用stateflow来说明simulink模型是如何相应输入信号的

##### 创建Stateflow模型

方法1：在Simulink库中找到Stateflow模块库的chart模块，将其添加到Simulink开发环境中

方法2：在Matlab命令行窗口输入命令`sf`，即可打开Stateflow工具箱`sflib`,并创建新的包含chart模块的Stateflow模型文件

##### Stateflow框图形式分类

- 在Stateflow模型中，将包含由状态的Stateflow框图成为状态图
- 在Stateflow模型中，讲不包含任何状态的Stateflow框图称为流程图

### 连接节点(Junction)

NOTE:

- 连接节点不是记忆元件，在状态图中任何转移的执行都不能停留在节点上，转移必须到达某个状态才能停止

- 依靠连接节点完成通路的连接和判断分支

### 转移

**创建转移的具体步骤**

1. 当鼠标光标接近状态的边缘时，鼠标光标将变成`十字形状`
2. 按下鼠标左键并保持，将引出的转移线放到目标状态的边缘即可

**概述**

- 当转移发生时，原状态变为非活动状态，目标状态变为活动状态
- 从图形上看，转移是带有箭头的线，是整个状态图或流程图变成了有向图

##### 默认转移

默认转移是一类特殊的状态转移。根据要求，当有限状态系统被激活时，必有相应的确定的某个状态被激活

##### 转移标签

- 一个完整的转移标签由四部分组成`event[conditon]{conditon actions}/{transtion actions}`
- `？`是默认的转移标签
- 转移标签的四个部分不一定完整出现，但不论出现哪些内容，标签内容必须按顺序写

**转移标签组成**

1. 事件：事件触发器指在已指定条件且条件为 true 时导致转移发生的事件。未指定事件表示在**发生任意事件时**都会产生该转移（什么时候会发生事件，在条件满足时）
2. 条件：条件表达式可以用`布尔操作符`和`逻辑操作符`进行判断
3. 条件动作：在转移标签语法中，条件动作接在转移条件后，只要条件计算结果为 true，条件动作即开始执行，无论转移至目标的路径是否有效。如果未指定任何条件，则隐含的条件会计算为 true，并执行条件动作。例如`满足条件X>1,执行赋值运算`
4. 转移动作：只有在整个转移路都有效时才能执行

##### Stateflow规定的转移优先级

1. 父状态转移优先于子状态转移
2. 同一层级安装**执行序号**转移（一个状态发生两个转移时，会有转移序号）

**问题**

条件动作和转移动作的区别：条件动作在条件满足时就能执行。而转移动作需要在整个转移通路都有效的情况下，在执行转移的时候才能执行

##### note：

1. 流程图不能包含任何状态，只能依靠连接节点完成通路的连接和判断分支

### 状态图（state)：

##### 状态名

添加的状态通过左上角`?`来表示目前状态还没有具体定义。

状态名命名要以字符开始

##### 状态标签

组成

1. 状态名称
2. 注释（可省略）`%注释内容`
3. 响应的状态动作

##### 状态动作

状态动作的关键字有三种：

1. entry/en:在状态被激活的**那一时刻**所执行的动作
2. exit/ex：当状态退出活动状态是执行相应的动作
3. during/du：当状态保持活动状态时执行相应的动作

### 流程图

简介：

- 流程图是不包含状态的Stateflow框图。流程图当中没有状态，主要用到的图形对象是连接节点和转移，用到的非图形对象就是数据对象
- 流程图总是从默认转移开始执行
- 流程图在无有效转移分支的节点上中止
- 流程图中默认转移的节点为判断节点，将**优先检测具有条件的分支**，如果条件满足则执行动作action,否则执行无条件转移，那里没有任何动作。最后所有转移都汇合到中止节点
- 连续的两次触发之间，流程图一直处于非活动状态
- 

流程图的创建：

1. 顺序结构 ：程序语句按照由上至下的次序依次执行
2. 选择结构：根据不同的条件进行判断，然后根据判断的结构选择某一种方法来解决某个问题
3. 循环结构：
   1. 程序中的某一条语句或者多条语句可以重复多次的执行
   2. `while循环`与`do while`循环

### 状态图与流程图的关系

- 状态框图有且只有一个状态图是要活着的
- 流程图只有节点和转移条件，没有记忆能力

## 问题

1. 如何建立一个simlink模型

2. 如何为自己搭建的模型设置输入输出

   通过`Model Explorer`

## 实践问题

**PORT NUMBER什么作用？**

PORT NUMBER定义了信号的输入/输出顺序

**状态图中没有写入转移动作的关键字，为什么？**

因为当du,en,ex三个状态输出值一样的时候就不用定义，省事

**为什么在故障状态时仍要进行防抖处理？**

可能会出现信号不稳定的情况

**Model Explorer**--**模型资源管理器**

1. Base Workspce--基础工作区
2. Model Workspce--模型工作区    使用模型工作区来定义和存储局部数据变量，模型工作区中定义的变量仅在具有唯一命名空间的模型作用域内可见。因此，您可以在多个模型工作区中使用相同的变量名称
3. simlink数据字典  --使用数据字典来定义和存储全局数据、在模型之间共享数据并跟踪对数据所做的更改。数据保存在独立于模型的文件中。

**Model Configuration Parameter**--模型配置参数

**采样时间**

**每一步所用的时间与start time与stop time之间的关系**

matlab会得到测试的步数，根据开始时间与结束时间计算出每一步需要的时间

**什么是容差？**

Relative Tolerance:相对容差

Absolute Tolerance:绝对容差

简单理解，是用来控制精确度的，使用时不必纠结。

**计数与计时**

Simulink软件开发中，常用计数表示计时。例如：数字默认值是1，运行一步加一，一步代表10ms，50s的抖动处理令结果大于5即可

