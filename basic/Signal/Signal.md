# vcu信号处理

## 实现的服务

信号处理（VIS，Vehcile Input Signal）模块功能主要是对制动开关信号、加速踏板位置信号、真空泵压力信号、刹车信号、挡位信号、空调信号、PTC 开关信号、电机 温度信号等，进行相应的去抖或仲裁处理。

## 服务的实现

### 1. 信号采集

**VCU通过什么采集信号？**

- VCU上有大量的PIN角，与PIN角相连的大多都是硬线线束，也有CAN线，通过这些PIN角采集信号

**VCU采集到的信号有哪几种？**

1. 硬线信号：VCU通过`硬线线束`与信号源直接连接，采集到的信号

   1. 数字量信号

      在时间和数字上都是离散的物理量称为数字量，例如空调开关，制动状态

      - 高电平
      - 低电平
      - 高有效
      - 低有效

   2. 模拟信号

      在时间和数值上都是连续的信号，经过抽样和量化后可以转化为数字量。例如加速踏板，环境温度

2. CAN线信号：基于共同的整车CAN网络协议，实现各控制单元的信息共享

### 数据读取与发送

硬线信号数据读取与发送

CAN信号数据读取与发送

1. VCU读取CAN报文数据：在实际开发工程中，控制单元底层CAN驱动模块接受其他控制单元的CAN报文数据，仅有该数据不能获取有效信息，需要`配合dbc文件打包成一条完成的CAN消息`，再按照`预先设定的CAN网络协议`将其解析出有效信号
2. VCU发送CAN报文数据：如同读取VCU报文的方法，VCU发送CAN报文时，仅发送不包含数据参数信息的CAN报文数据段，故VCU须按照预先设定的CANA网络协议将自身处理得到的**信号打包成完整的CAN消息**，再**提取**消息中的数据段形成CAN报文数据，发送给其他控制单元使用

### 去抖

### 知识点巩固 - 问答

1. 车载开关为机械弹性开关, 这些触点开关有什么特征?
   开关在闭合时不会马上稳定的接通，在断开时也不会一下彻底断开，在闭合和断开的瞬间发生了一连串的抖动。当检测到开关状态变化时，先等待一段时间，让抖动消失后再进行一次开关检测状态，如果与刚才检测到的状态相同，则认为开关已经稳定的动作了

2. 常见的去抖方法有哪些?
   硬件去抖：添加滤波电路，对抖动过程中产生的电压毛刺进行平滑处理，从而实现消抖。去抖效果好，单增加了电路复杂度和产品成本

   软件去抖：通过延时程序过滤抖动 ，成本低

3. 报文数据，消息，信号的定义
   CAN报文数据：VCU底层CAN驱动以数组变量的形式定义的CAN报文数据；只包含原始数据值，无有效参数
   CAN消息：一列信号的组合；不只是数据值，还有数据参数，比如类型，名称，精度，长度等
   打包：将数据值打包成具有参数的消息
   信号：CAN消息所携带的具体信号信息，比如电池电压，电机扭矩，充电请求等等
   解包：将完整的消息解析成独立的信号信息
   
4. 如何通过Simulink模型获得CAN报文信息？



## 实践问题

开发文档中一般只有功能需求，对于变量的命名要求不是太多，需要根据自己的理解进行。

**加速踏板位置信号**

Saturation Dynamic：限幅模块，输出值可以是输入信号u，也可以是结界值up/lo

延时模块：将信号延迟一个采样时间

​	两个参数：1.初始值 2. 采样时间

​	采样时间设为-1代表继承模型设置的采样时间

**信号输入问题**

1. 先搭建模型，设置了Input和Outpot,模型搭建完成后封装，封装后子系统外部也有一个Input和Outpot，这个可以修改为要输入的信号
2. 先创建subsystem，模型搭建完毕外部有相应的输入和输出接口，连接对应的信号模块或信号即可

**测量点：**

什么是测量点：可以在测试过程中看以看到的信号值，对一些关键的信息一定要添加测量点

自己电脑无法在matlab中添加测量点，需要依赖motohawk中的probe标签添加测量点

在测试中想把标定量进行修改也需要添加motohawk的一维查表模块，例如<img src="C:\Users\123\AppData\Roaming\Typora\typora-user-images\image-20211114165947578.png" alt="image-20211114165947578" style="zoom:67%;" />

**标定与观测**

测试量与标定量

标定文件中包含了 VCU 软件模型所有标定量数据参数

使用 MotoTune 软件可以直接监控 VCU 实际运行时的内部数据状态，并通过修改 VCU 标定值，观察标定数据对 VCU 功能的影响，从而验证相应的 VCU 功能。

**问题：标定与观测与模型搭建无法顺畅的连接起来**
