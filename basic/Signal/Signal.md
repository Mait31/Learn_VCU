# vcu信号处理

**VCU信号处理模块功能概述**

信号处理（VIS，Vehcile Input Signal）模块功能主要是对制动开关信号、加速踏板位置信号、真空泵压力信号、刹车信号、挡位信号、空调信号、PTC 开关信号、电机 温度信号等，进行相应的去抖或仲裁处理。

#### 基本知识：

硬件电路是信号传递的载体

**ADC转换电路的作用？**

- ADC(Analog to Digital Converter,A/D转换)，将外部模拟信号转化为数字信号，数字信号用0和1表示	

**ADC有什么参数？**

1. 参考电压：ADC所能采集到的最大有效电压
2. 位宽：ADC采用二进制位数
3. 分辨率：ADC每个bit表示的电压值，即`参考电压与2^n-1的比值`，n为位宽

**模拟信号如何转化为数字信号的？**

模拟信号转化为数字信号，本质上是硬件电路和底层软件结合处理的结果

**底层软件是何如处理数字信号将其转化为电压值的？**

ADC转化电路将模拟信号转化为数字信号后得到的是二进制位数，每一位都有自己的分辨率，两者相乘，就能得到电压值

**ADC采样电路与ADC转换电路的关系？**

ADC采样电路采集传感器信号，通过AD转换电路将模拟信号转化为数字信号，数字信号经过底层处理运算后得到传感器实际电压值

**为什么要用ADC转换器？**

- 控制器芯片属于数字器件，需将模拟信号转化为数字信号才能被芯片处理。这就需要模拟转换器ADC

**VCU通过什么采集信号？**

- VCU上有大量的PIN角，与PIN角相连的大多都是硬线线束，也有CAN线，通过这些PIN角采集信号

**VCU采集到的信号有哪几种？**

1. 硬线信号：VCU通过`硬线线束`与信号源直接连接，采集到的信号

2. CAN线信号：基于共同的整车CAN网络协议，实现各控制单元的信息共享

**硬线信号又有哪些**？

1. 数字量信号

   在时间和数字上都是离散的物理量称为数字量，例如空调开关，制动状态

   - 高电平
   - 低电平
   - 高有效
   - 低有效

2. 模拟信号

   在时间和数值上都是连续的信号，经过抽样和量化后可以转化为数字量。例如加速踏板，环境温度

**常见的数字量信号和模拟量信号有哪些?**

数字量信号：低压上电开关，启动状态，制动开关，空调开关闭，PTC开关，挡位状态

模拟量信号：加速踏板位置，真空泵压力，电机温度，蓄电池电压

**VCU通过硬线与蓄电池直接连接，不能直接采集到对应的电压值，为什么？**

蓄电池放电，电机温度，人的说话声音皆为模拟信号。VCU与蓄电池连接，采集到电信号经底层软件处理转化为对应的电压值送到应用层软件

**车载开关都有什么特性？**

车载开关一般位机械弹性开关，不论是旋钮还是按键，其本质都是触点开关

机械特性：开关在闭合时不会马上稳定的接通，在断开时也不会一下彻底断开，在闭合和断开的瞬间发生了一连串的抖动。当检测到开关状态变化时，先等待一段时间，让抖动消失后再进行一次开关检测状态，如果与刚才检测到的状态相同，则认为开关已经稳定的动作了

**去抖方法有哪些？**

硬件去抖：添加滤波电路，对抖动过程中产生的电压毛刺进行平滑处理，从而实现消抖。去抖效果好，单增加了电路复杂度和产品成本

软件去抖：通过延时程序过滤抖动 ，成本低

**基于模型的设计方法（MBD/Model Based Design)和测试方法的关系？**

基于模型的设计方法采用图形化设计和自动化代码生成，不同于基于手工编程和纸上规范的传统编程方法。基于模型的设计方法的不同阶段，分别采用MIL/SIL/PIL/HIL等测试方法，有效的对嵌入式代码进行测试和验证。其中：

MIL，Model in the Loop：模型在环测试；

SIL，Software in the Loop：软件在环测试；SIL的目的是为了验证生成的代码和模型在功能上是否一致，或者说验证生成的代码和模型在功能上是否等效。

PIL，Processor in the Loop：处理器在环测试；被测对象：编译后的代码

HIL，Hardware in the Loop：硬件在环测试。被测对象：控制器

<hr>

1. 如何通过Simulink模型获得CAN报文信息？
2. 报文数据，消息，信号的定义
   - CAN报文数据：VCU底层CAN驱动以数组变量的形式定义的CAN报文数据；只包含原始数据值，无有效参数
   - CAN消息：一列信号的组合；不只是数据值，还有数据参数，比如类型，名称，精度，长度等
   - 打包：将数据值打包成具有参数的消息
   - 信号：CAN消息所携带的具体信号信息，比如电池电压，电机扭矩，充电请求等等
   - 解包：将完整的消息解析成独立的信号信息

3. VCU读取CAN报文数据：在实际开发工程中，控制单元底层CAN驱动模块接受其他控制单元的CAN报文数据，仅有该数据不能获取有效信息，需要`配合dbc文件打包成一条完成的CAN消息`，再按照`预先设定的CAN网络协议`将其解析出有效信号
4. VCU发送CAN报文数据：如同读取VCU报文的方法，VCU发送CAN报文时，仅发送不包含数据参数信息的CAN报文数据段，故VCU须按照预先设定的CANA网络协议将自身处理得到的**信号打包成完整的CAN消息**，再**提取**消息中的数据段形成CAN报文数据，发送给其他控制单元使用

5. VCU开发流程
   1. 需求分析
      1. 形成需求规范
      2. 开发平台选择
   2. 系统设计
      1. 网络架构设计
      2. 软件架构设计
   3. 软件设计
      1. 控制策略设计（根据VCU软件架构，将功能需求转化为详细的控制策略）
         1. 工具：office
         2. 交付物：设计说明文档
      2. 算法模型搭建（根据设计说明，搭建软件策略模型，生成c代码）
         1. 工具MATLAB/SIMULINK
         2. 交付物：策略模型
      3. 模型仿真测试（根据策略模型，创建模型单元测试环境，编写测试用例，验证模型功能）
         1. 工具：SIMULINK
         2. 交付物：测试报告
         3. MIL测试通俗一点理解就是对模型在模型的开发环境下（如SIMULINK）进行仿真，通过输入一系列的测试用例，验证模型是否满足了设计的功能需求。
   4. 软件实现
      1. 自动代码生成
      2. 软硬件集成
   5. HIL测试
      1. 搭建HIL测试模型
      2. 自动化仿真测试
   6. 台架测试
      1. 台架测试
      2. 基础标定
   7. 实车测试
      1. 整车标定
      2. 原型样车

## 实践问题

**加速踏板位置信号**

Saturation Dynamic：限幅模块，输出值可以是输入信号u，也可以是结界值up/lo

延时模块：将信号延迟一个采样时间

​	两个参数：1.初始值 2. 采样时间

​	采样时间设为-1代表继承模型设置的采样时间

**信号输入问题**

1. 先搭建模型，设置了Input和Outpot,模型搭建完成后封装，封装后子系统外部也有一个Input和Outpot，这个可以修改为要输入的信号
2. 先创建subsystem，模型搭建完毕外部有相应的输入和输出接口，连接对应的信号模块或信号即可

**标定与观测**

测试量与标定量

标定文件中包含了 VCU 软件模型所有标定量数据参数

使用 MotoTune 软件可以直接监控 VCU 实际运行时的内部数据状态，并通过修改 VCU 标定值，观察标定数据对 VCU 功能的影响，从而验证相应的 VCU 功能。

**问题：标定与观测与模型搭建无法顺畅的连接起来**
